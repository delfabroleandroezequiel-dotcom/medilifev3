@model MedilifeSaludV3.Web.Models.Presupuesto
@{
    Layout = null;
    var empresa = Model.Empresa;
    var paciente = Model.Paciente;
    var medico = Model.Medico;
    var prestador = Model.Prestador;
    var institucion = Model.Institucion;
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Presupuesto @Model.Numero</title>
    <style>
        @@page { size: A4; margin: 14mm; }
        body { font-family: Arial, Helvetica, sans-serif; color: #000; }
        .sheet { position: relative; }
        .watermark {
            position: absolute;
            left: 50%;
            top: 52%;
            transform: translate(-50%, -50%);
            width: 140mm; /* ajustá a gusto */
            opacity: 0.10; /* watermark suave */
            z-index: 0;
            pointer-events: none;
        }

        table { width: 100%; border-collapse: collapse; }
        .box td { border: 1px solid #333; padding: 6px; vertical-align: top; }
        .title { text-align: center; font-weight: 700; }
        .small { font-size: 12px; }
        .header-left .h1 { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .meta { font-size: 12px; line-height: 1.3; }
        .items th, .items td { border-top: 1px solid #333; padding: 8px 6px; font-size: 12px; }
        .items th { text-align: left; }
        .items td.num, .items th.num { text-align: right; }
        .totals { margin-top: 10px; }
        .totals td { border: 1px solid #333; padding: 8px 6px; }
        .footnote { font-size: 11px; border: 1px solid #333; padding: 8px 6px;border-top:none; }
        .actions { margin: 0 0 10px 0; display: flex; justify-content: flex-end; gap: 8px; }
        @@media print {
            .actions { display: none; }
        }
    </style>
</head>
<body>
    <div class="actions">
        <button onclick="window.print()" type="button">Imprimir</button>
    </div>

    <div class="sheet">
        <img class="watermark" src="~/img/watermark.png" alt="" />

        <table class="box">
            <tr>
                <td style="width:45%" class="header-left">
                    <div class="h1">@(empresa?.NombreEmpresa ?? empresa?.RazonSocial ?? "Empresa")</div>
                    <div class="meta">
                        <div><b>Razón social:</b> @empresa?.RazonSocial</div>
                        <div><b>Teléfono:</b> @empresa?.Telefono</div>
                        <div><b>CUIT/CUIL:</b> @empresa?.Cuil</div>
                        <div><b>Dirección:</b> @empresa?.Direccion</div>
                    </div>
                </td>
                <td style="width:30%" class="title">
                    <div style="font-size:14px;">Presupuesto</div>
                    <div style="font-size:20px;">X</div>
                </td>
                <td style="width:25%" class="title">
                    <div><b>N°:</b> @Model.Numero</div>
                    <div><b>Fecha:</b> @Model.Fecha.ToString("dd/MM/yyyy")</div>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="small">
                    <table style="width:100%; border-collapse:collapse;">
                        <tr>
                            <td style="width:50%; padding:4px 0;border: none;"><b>Institución:</b> @(institucion?.Nombre ?? "")</td>
                            <td style="width:50%; padding:4px 0;border: none;"><b>Doctor:</b> @(medico != null ? (medico.Apellido + " " + medico.Nombre) : "")</td>
                        </tr>
                        <tr>
                            <td style="padding:4px 0;border: none;"><b>Obra social:</b> @(prestador?.Nombre ?? "")</td>
                            <td style="padding:4px 0;border: none;"><b>Paciente:</b> @(paciente != null ? (paciente.Apellido + " " + paciente.Nombre) : "")</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <table class="items" style="margin-top:8px;">
            <thead>
                <tr>
                    <th style="width:10%">Cantidad</th>
                    <th style="width:55%">Descripción</th>
                    <th style="width:17%" class="num">Precio (u)</th>
                    <th style="width:18%" class="num">Precio (t)</th>
                </tr>
            </thead>
            <tbody style="height: 650px;vertical-align: top;">
                @foreach (var it in Model.Items.OrderBy(i => i.Orden))
                {
                    <tr>
                        <td class="num">(@it.Cantidad)</td>
                        <td>@it.Detalle</td>
                        <td class="num">$ @it.PrecioUnitario.ToString("N2")</td>
                        <td class="num">$ @it.TotalLinea.ToString("N2")</td>
                    </tr>
                }
            </tbody>
        </table>

        <table class="totals">
            <tr>
                <td style="width:80%; font-size:11px;">@Model.TotalEnLetras</td>
                <td style="width:20%; text-align:right;"><b>$ @Model.Total.ToString("N2")</b></td>
            </tr>
        </table>

        <div class="footnote">
            @Model.DescripcionPago
        </div>
    </div>
</body>
</html>
